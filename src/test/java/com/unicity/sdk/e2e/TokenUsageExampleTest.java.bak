package com.unicity.sdk.e2e;

import com.unicity.sdk.StateTransitionClient;
import com.unicity.sdk.api.AggregatorClient;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.condition.EnabledIfEnvironmentVariable;

import static org.junit.jupiter.api.Assertions.*;

/**
 * End-to-end tests for token usage examples.
 * These tests require a running aggregator service.
 * Set AGGREGATOR_URL environment variable to run these tests.
 */
@EnabledIfEnvironmentVariable(named = "AGGREGATOR_URL", matches = ".+")
public class TokenUsageExampleTest {

    private AggregatorClient aggregatorClient;
    private StateTransitionClient client;

    @BeforeEach
    void setUp() {
        String aggregatorUrl = System.getenv("AGGREGATOR_URL");
        assertNotNull(aggregatorUrl, "AGGREGATOR_URL environment variable must be set");
        
        aggregatorClient = new AggregatorClient(aggregatorUrl);
        client = new StateTransitionClient(aggregatorClient);
    }

    @Test
    void testVerifyBlockHeight() throws Exception {
        Integer blockHeight = aggregatorClient.getBlockHeight().get();
        System.out.println("block height: " + blockHeight);
        assertNotNull(blockHeight);
        assertTrue(blockHeight > 0);
    }

    @Test
    void testTokenTransfer() throws Exception {
        CommonTestFlow.testTransferFlow(client);
    }

    @Test
    void testOfflineTokenTransfer() throws Exception {
        CommonTestFlow.testOfflineTransferFlow(client);
    }

    /*
    @Test
    void testSplitTokens() throws Exception {
        CommonTestFlow.testSplitFlow(client);
    }

    @Test
    void testSplitTokensAfterTransfer() throws Exception {
        CommonTestFlow.testSplitFlowAfterTransfer(client);
    }
    */
}